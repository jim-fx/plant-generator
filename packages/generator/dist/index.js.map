{"version":3,"file":"index.js","sources":["../src/executeSkeletonNode.ts","../src/executeGeometryNode.ts","../src/createContext.ts","../src/plant.ts"],"sourcesContent":["import Nodes from '@plantarium/nodes';\n\nconst nodes: { [type: string]: PlantNode } = {};\n\nNodes.forEach((n) => {\n  nodes[n.type] = n;\n});\n\nexport default (node: SkeletonResult, ctx: GeneratorContext) => {\n  if (node.type in nodes) {\n    return nodes[node.type].computeSkeleton(node, ctx);\n  }\n\n  return node.result;\n};\n","import Nodes from '@plantarium/nodes';\n\nconst nodes: { [type: string]: PlantNode } = {};\n\nNodes.forEach((n) => {\n  nodes[n.type] = n;\n});\n\nexport default (node: SkeletonResult, ctx: GeneratorContext) => {\n  if (node.type in nodes) {\n    return nodes[node.type].computeGeometry(node, ctx);\n  }\n\n  return node.result;\n};\n","let lastSettings = '';\nlet lastCtx;\n\nconst createContext = (s: PlantariumSettings): GeneratorContext => {\n  return {\n    handleParameter(param: ParameterResult, alpha?: number) {\n      return alpha;\n    },\n    getSetting(key: string) {\n      return s[key];\n    },\n    get seed() {\n      return Math.random();\n    },\n    refresh() {\n      return Math.random();\n    },\n  };\n};\n\nexport default (settings: PlantariumSettings) => {\n  const s = JSON.stringify(settings);\n\n  if (s !== lastSettings) {\n    lastSettings = s;\n    lastCtx = createContext(settings);\n  }\n\n  return lastCtx;\n};\n","import { logger } from '@plantarium/helpers';\nimport { calculateNormals } from '@plantarium/geometry';\n\nimport executeSkeletonNode from './executeSkeletonNode';\nimport executeGeometryNode from './executeGeometryNode';\nimport createContext from 'createContext';\n\nconst log = logger('gen.plant');\n\nconst isNode = (value): value is NodeResult => {\n  return typeof value === 'object' && 'type' in value;\n};\n\nconst handleSkeletonNode = (node, ctx: GeneratorContext): SkeletonResult => {\n  log('skeleton.' + node.type, node);\n\n  const parameters = {};\n  Object.entries(node.parameters).forEach(([key, value]) => {\n    parameters[key] = isNode(value) ? handleSkeletonNode(value, ctx) : value;\n  });\n  node.parameters = parameters;\n\n  node.result = executeSkeletonNode(node, ctx);\n\n  log('skeleton.' + node.type, node.result);\n\n  return node;\n};\n\nconst handleGeometryNode = (node, ctx) => {\n  log('geometry.' + node.type, node);\n\n  const parameters = {};\n  Object.entries(node.parameters).forEach(([key, value]) => {\n    parameters[key] = isNode(value) ? handleGeometryNode(value, ctx) : value;\n  });\n\n  node.parameters = parameters;\n\n  node.result = { ...node.result, ...executeGeometryNode(node, ctx) };\n\n  log('geometry.' + node.type, node.result);\n\n  return node;\n};\n\nexport default function plant(rootNode: NodeResult, s: PlantariumSettings) {\n  const ctx = createContext(s);\n  console.log(rootNode, ctx);\n\n  const skelly = handleSkeletonNode(rootNode, ctx);\n\n  log('final skeleton', skelly);\n\n  const final = handleGeometryNode(skelly, ctx);\n\n  log('geo', final);\n\n  const { result } = final;\n\n  result.geometry = calculateNormals(result.geometry);\n\n  return result;\n}\n"],"names":["nodes","Nodes","forEach","n","type","lastCtx","lastSettings","log","logger","isNode","value","rootNode","s","ctx","settings","JSON","stringify","handleParameter","param","alpha","getSetting","key","seed","Math","random","refresh","createContext","console","skelly","handleSkeletonNode","node","parameters","Object","entries","result","computeSkeleton","executeSkeletonNode","final","handleGeometryNode","computeGeometry","executeGeometryNode","geometry","calculateNormals"],"mappings":"mkvBAEMA,mPAAuC,IAE7CC,EAAMC,QAAQ,SAACC,GACbH,EAAMG,EAAEC,MAAQD,IAGlB,ICNMH,EAAuC,GAE7CC,EAAMC,QAAQ,SAACC,GACbH,EAAMG,EAAEC,MAAQD,IAGlB,ICPIE,EADAC,EAAe,GCObC,EAAMC,EAAO,aAEbC,EAAS,SAACC,GACd,MAAwB,iBAAVA,GAAsB,SAAUA,yGAoChD,SAA8BC,EAAsBC,GAClD,IAAMC,WD3BQC,GACd,IAAMF,EAAIG,KAAKC,UAAUF,GAOzB,OALIF,IAAMN,IACRA,EAAeM,EACfP,EAtBkB,SAACO,GACrB,MAAO,CACLK,yBAAgBC,EAAwBC,GACtC,OAAOA,GAETC,oBAAWC,GACT,OAAOT,EAAES,IAEXC,WACE,OAAOC,KAAKC,UAEdC,mBACE,OAAOF,KAAKC,WAUJE,CAAcZ,IAGnBT,ECmBKqB,CAAcd,GAC1Be,QAAQpB,IAAII,EAAUE,GAEtB,IAAMe,EArCmB,SAArBC,EAAsBC,EAAMjB,GAChCN,EAAI,YAAcuB,EAAK1B,KAAM0B,GAE7B,IAAMC,EAAa,GAUnB,OATAC,OAAOC,QAAQH,EAAKC,YAAY7B,QAAQ,gBAAOQ,OAC7CqB,QAAkBtB,EAAOC,GAASmB,EAAmBnB,EAAOG,GAAOH,IAErEoB,EAAKC,WAAaA,EAElBD,EAAKI,gBHdSJ,EAAsBjB,GACpC,OAAIiB,EAAK1B,QAAQJ,EACRA,EAAM8B,EAAK1B,MAAM+B,gBAAgBL,EAAMjB,GAGzCiB,EAAKI,OGSEE,CAAoBN,EAAMjB,GAExCN,EAAI,YAAcuB,EAAK1B,KAAM0B,EAAKI,QAE3BJ,EAwBQD,CAAmBlB,EAAUE,GAE5CN,EAAI,iBAAkBqB,GAEtB,IAAMS,EAzBmB,SAArBC,EAAsBR,EAAMjB,GAChCN,EAAI,YAAcuB,EAAK1B,KAAM0B,GAE7B,IAAMC,EAAa,GAWnB,OAVAC,OAAOC,QAAQH,EAAKC,YAAY7B,QAAQ,gBAAOQ,OAC7CqB,QAAkBtB,EAAOC,GAAS4B,EAAmB5B,EAAOG,GAAOH,IAGrEoB,EAAKC,WAAaA,EAElBD,EAAKI,YAAcJ,EAAKI,gBF/BVJ,EAAsBjB,GACpC,OAAIiB,EAAK1B,QAAQJ,EACRA,EAAM8B,EAAK1B,MAAMmC,gBAAgBT,EAAMjB,GAGzCiB,EAAKI,OE0BuBM,CAAoBV,EAAMjB,IAE7DN,EAAI,YAAcuB,EAAK1B,KAAM0B,EAAKI,QAE3BJ,EAWOQ,CAAmBV,EAAQf,GAEzCN,EAAI,MAAO8B,OAEHH,EAAWG,EAAXH,OAIR,OAFAA,EAAOO,SAAWC,mBAAiBR,EAAOO,UAEnCP"}