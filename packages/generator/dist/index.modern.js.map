{"version":3,"file":"index.modern.js","sources":["../src/executeSkeletonNode.ts","../src/executeGeometryNode.ts","../src/createContext.ts","../src/plant.ts"],"sourcesContent":["import Nodes from '@plantarium/nodes';\n\nconst nodes: { [type: string]: PlantNode } = {};\n\nNodes.forEach((n) => {\n  nodes[n.type] = n;\n});\n\nexport default (node: SkeletonResult, ctx: GeneratorContext) => {\n  if (node.type in nodes) {\n    return nodes[node.type].computeSkeleton(node, ctx);\n  }\n\n  return node.result;\n};\n","import Nodes from '@plantarium/nodes';\n\nconst nodes: { [type: string]: PlantNode } = {};\n\nNodes.forEach((n) => {\n  nodes[n.type] = n;\n});\n\nexport default (node: SkeletonResult, ctx: GeneratorContext) => {\n  if (node.type in nodes) {\n    return nodes[node.type].computeGeometry(node, ctx);\n  }\n\n  return node.result;\n};\n","let lastSettings = '';\nlet lastCtx;\n\nconst createContext = (s: PlantariumSettings): GeneratorContext => {\n  return {\n    handleParameter(param: ParameterResult, alpha?: number) {\n      return alpha;\n    },\n    getSetting(key: string) {\n      return s[key];\n    },\n    get seed() {\n      return Math.random();\n    },\n    refresh() {\n      return Math.random();\n    },\n  };\n};\n\nexport default (settings: PlantariumSettings) => {\n  const s = JSON.stringify(settings);\n\n  if (s !== lastSettings) {\n    lastSettings = s;\n    lastCtx = createContext(settings);\n  }\n\n  return lastCtx;\n};\n","import { logger } from '@plantarium/helpers';\nimport { calculateNormals } from '@plantarium/geometry';\n\nimport executeSkeletonNode from './executeSkeletonNode';\nimport executeGeometryNode from './executeGeometryNode';\nimport createContext from 'createContext';\n\nconst log = logger('gen.plant');\n\nconst isNode = (value): value is NodeResult => {\n  return typeof value === 'object' && 'type' in value;\n};\n\nconst handleSkeletonNode = (node, ctx: GeneratorContext): SkeletonResult => {\n  log('skeleton.' + node.type, node);\n\n  const parameters = {};\n  Object.entries(node.parameters).forEach(([key, value]) => {\n    parameters[key] = isNode(value) ? handleSkeletonNode(value, ctx) : value;\n  });\n  node.parameters = parameters;\n\n  node.result = executeSkeletonNode(node, ctx);\n\n  log('skeleton.' + node.type, node.result);\n\n  return node;\n};\n\nconst handleGeometryNode = (node, ctx) => {\n  log('geometry.' + node.type, node);\n\n  const parameters = {};\n  Object.entries(node.parameters).forEach(([key, value]) => {\n    parameters[key] = isNode(value) ? handleGeometryNode(value, ctx) : value;\n  });\n\n  node.parameters = parameters;\n\n  node.result = { ...node.result, ...executeGeometryNode(node, ctx) };\n\n  log('geometry.' + node.type, node.result);\n\n  return node;\n};\n\nexport default function plant(rootNode: NodeResult, s: PlantariumSettings) {\n  const ctx = createContext(s);\n  console.log(rootNode, ctx);\n\n  const skelly = handleSkeletonNode(rootNode, ctx);\n\n  log('final skeleton', skelly);\n\n  const final = handleGeometryNode(skelly, ctx);\n\n  log('geo', final);\n\n  const { result } = final;\n\n  result.geometry = calculateNormals(result.geometry);\n\n  return result;\n}\n"],"names":["nodes","Nodes","forEach","n","type","node","ctx","computeGeometry","result","lastCtx","lastSettings","log","logger","isNode","value","handleSkeletonNode","parameters","Object","entries","key","computeSkeleton","executeSkeletonNode","handleGeometryNode","executeGeometryNode","plant","rootNode","s","settings","JSON","stringify","handleParameter","param","alpha","getSetting","seed","Math","random","refresh","createContext","console","skelly","final","geometry","calculateNormals"],"mappings":"4mvBAEA,MAAMA,EAAuC,GAE7CC,EAAMC,QAASC,IACbH,EAAMG,EAAEC,MAAQD,UCHZH,EAAuC,GAE7CC,EAAMC,QAASC,IACbH,EAAMG,EAAEC,MAAQD,IAGlB,OAAgBE,EAAsBC,IAChCD,EAAKD,QAAQJ,EACRA,EAAMK,EAAKD,MAAMG,gBAAgBF,EAAMC,GAGzCD,EAAKG,OCbd,IACIC,EADAC,EAAe,GCOnB,MAAMC,EAAMC,EAAO,aAEbC,EAAUC,GACU,iBAAVA,GAAsB,SAAUA,EAG1CC,EAAqB,CAACV,EAAMC,KAChCK,EAAI,YAAcN,EAAKD,KAAMC,GAE7B,MAAMW,EAAa,GAUnB,OATAC,OAAOC,QAAQb,EAAKW,YAAYd,QAAQ,EAAEiB,EAAKL,MAC7CE,EAAWG,GAAON,EAAOC,GAASC,EAAmBD,EAAOR,GAAOQ,IAErET,EAAKW,WAAaA,EAElBX,EAAKG,SHdSH,EAAsBC,IAChCD,EAAKD,QAAQJ,EACRA,EAAMK,EAAKD,MAAMgB,gBAAgBf,EAAMC,GAGzCD,EAAKG,OGSEa,CAAoBhB,EAAMC,GAExCK,EAAI,YAAcN,EAAKD,KAAMC,EAAKG,QAE3BH,GAGHiB,EAAqB,CAACjB,EAAMC,KAChCK,EAAI,YAAcN,EAAKD,KAAMC,GAE7B,MAAMW,EAAa,GAWnB,OAVAC,OAAOC,QAAQb,EAAKW,YAAYd,QAAQ,EAAEiB,EAAKL,MAC7CE,EAAWG,GAAON,EAAOC,GAASQ,EAAmBR,EAAOR,GAAOQ,IAGrET,EAAKW,WAAaA,EAElBX,EAAKG,OAAS,IAAKH,EAAKG,UAAWe,EAAoBlB,EAAMC,IAE7DK,EAAI,YAAcN,EAAKD,KAAMC,EAAKG,QAE3BH,GAGT,SAAwBmB,EAAMC,EAAsBC,GAClD,MAAMpB,GD3BQqB,IACd,MAAMD,EAAIE,KAAKC,UAAUF,GAOzB,OALID,IAAMhB,IACRA,EAAegB,EACfjB,EAtBmBiB,CAAAA,IACd,CACLI,gBAAe,CAACC,EAAwBC,IAC/BA,EAETC,WAAWd,GACFO,EAAEP,GAEXe,WACE,OAAOC,KAAKC,UAEdC,QAAO,IACEF,KAAKC,WAUJE,CAAcX,IAGnBlB,GCmBK6B,CAAcZ,GAC1Ba,QAAQ5B,IAAIc,EAAUnB,GAEtB,MAAMkC,EAASzB,EAAmBU,EAAUnB,GAE5CK,EAAI,iBAAkB6B,GAEtB,MAAMC,EAAQnB,EAAmBkB,EAAQlC,GAEzCK,EAAI,MAAO8B,GAEX,MAAMjC,OAAEA,GAAWiC,EAInB,OAFAjC,EAAOkC,SAAWC,EAAiBnC,EAAOkC,UAEnClC"}